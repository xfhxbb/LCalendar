window.LCalendar=function(){var e=function(){this.gearDate,this.minY=1900,this.minM=1,this.minD=1,this.maxY=2099,this.maxM=12,this.maxD=31};return e.prototype={init:function(e){if(this.type=e.type,this.trigger=document.querySelector(e.trigger),null!=this.trigger.getAttribute("data-lcalendar")){var t=this.trigger.getAttribute("data-lcalendar").split(","),a=t[0].split("-");this.minY=~~a[0],this.minM=~~a[1],this.minD=~~a[2];var r=t[1].split("-");this.maxY=~~r[0],this.maxM=~~r[1],this.maxD=~~r[2]}if(e.minDate){var a=e.minDate.split("-");this.minY=~~a[0],this.minM=~~a[1],this.minD=~~a[2]}if(e.maxDate){var r=e.maxDate.split("-");this.maxY=~~r[0],this.maxM=~~r[1],this.maxD=~~r[2]}return this.successCallback=e.successCallback||function(){},this.bindEvent(this.type),this},bindEvent:function(e){function t(){A.gearDate.addEventListener("click",function(e){return e.target.removeEventListener(e.type,arguments.callee),L(e,document.querySelector(".date_ctrl"))})}function a(e){A.gearDate=document.createElement("div"),A.gearDate.className="gearDate",A.gearDate.innerHTML='<div class="date_ctrl slideInUp"><div class="date_btn_box"><div class="date_btn lcalendar_cancel">取消</div><div class="date_btn lcalendar_finish">确定</div></div><div class="date_roll_mask"><div class="date_roll"><div><div class="gear date_yy" data-datetype="date_yy"></div><div class="date_grid"><div>年</div></div></div><div><div class="gear date_mm" data-datetype="date_mm"></div><div class="date_grid"><div>月</div></div></div><div><div class="gear date_dd" data-datetype="date_dd"></div><div class="date_grid"><div>日</div></div></div></div></div></div>',document.body.appendChild(A.gearDate),r();var a=A.gearDate.querySelector(".lcalendar_cancel");a.addEventListener("touchstart",b);var i=A.gearDate.querySelector(".lcalendar_finish");i.addEventListener("touchstart",D);var d=A.gearDate.querySelector(".date_yy"),n=A.gearDate.querySelector(".date_mm"),s=A.gearDate.querySelector(".date_dd");d.addEventListener("touchstart",m),n.addEventListener("touchstart",m),s.addEventListener("touchstart",m),d.addEventListener("touchmove",g),n.addEventListener("touchmove",g),s.addEventListener("touchmove",g),d.addEventListener("touchend",h),n.addEventListener("touchend",h),s.addEventListener("touchend",h),t(e)}function r(){var e=new Date,t={yy:e.getFullYear(),mm:e.getMonth(),dd:e.getDate()-1};/^\d{4}-\d{1,2}-\d{1,2}$/.test(A.trigger.value)?(rs=A.trigger.value.match(/(^|-)\d{1,4}/g),t.yy=rs[0]-A.minY,t.mm=rs[1].replace(/-/g,"")-1,t.dd=rs[2].replace(/-/g,"")-1):t.yy=t.yy-A.minY,A.gearDate.querySelector(".date_yy").setAttribute("val",t.yy),A.gearDate.querySelector(".date_mm").setAttribute("val",t.mm),A.gearDate.querySelector(".date_dd").setAttribute("val",t.dd),c()}function i(e){A.gearDate=document.createElement("div"),A.gearDate.className="gearDate",A.gearDate.innerHTML='<div class="date_ctrl slideInUp"><div class="date_btn_box"><div class="date_btn lcalendar_cancel">取消</div><div class="date_btn lcalendar_finish">确定</div></div><div class="date_roll_mask"><div class="ym_roll"><div><div class="gear date_yy" data-datetype="date_yy"></div><div class="date_grid"><div>年</div></div></div><div><div class="gear date_mm" data-datetype="date_mm"></div><div class="date_grid"><div>月</div></div></div></div></div></div>',document.body.appendChild(A.gearDate),d();var a=A.gearDate.querySelector(".lcalendar_cancel");a.addEventListener("touchstart",b);var r=A.gearDate.querySelector(".lcalendar_finish");r.addEventListener("touchstart",p);var i=A.gearDate.querySelector(".date_yy"),n=A.gearDate.querySelector(".date_mm");i.addEventListener("touchstart",m),n.addEventListener("touchstart",m),i.addEventListener("touchmove",g),n.addEventListener("touchmove",g),i.addEventListener("touchend",h),n.addEventListener("touchend",h),t(e)}function d(){var e=new Date,t={yy:e.getFullYear(),mm:e.getMonth()};/^\d{4}-\d{1,2}$/.test(A.trigger.value)?(rs=A.trigger.value.match(/(^|-)\d{1,4}/g),t.yy=rs[0]-A.minY,t.mm=rs[1].replace(/-/g,"")-1):t.yy=t.yy-A.minY,A.gearDate.querySelector(".date_yy").setAttribute("val",t.yy),A.gearDate.querySelector(".date_mm").setAttribute("val",t.mm),c()}function n(e){A.gearDate=document.createElement("div"),A.gearDate.className="gearDatetime",A.gearDate.innerHTML='<div class="date_ctrl slideInUp"><div class="date_btn_box"><div class="date_btn lcalendar_cancel">取消</div><div class="date_btn lcalendar_finish">确定</div></div><div class="date_roll_mask"><div class="datetime_roll"><div><div class="gear date_yy" data-datetype="date_yy"></div><div class="date_grid"><div>年</div></div></div><div><div class="gear date_mm" data-datetype="date_mm"></div><div class="date_grid"><div>月</div></div></div><div><div class="gear date_dd" data-datetype="date_dd"></div><div class="date_grid"><div>日</div></div></div><div><div class="gear time_hh" data-datetype="time_hh"></div><div class="date_grid"><div>时</div></div></div><div><div class="gear time_mm" data-datetype="time_mm"></div><div class="date_grid"><div>分</div></div></div></div></div></div>',document.body.appendChild(A.gearDate),s();var a=A.gearDate.querySelector(".lcalendar_cancel");a.addEventListener("touchstart",b);var r=A.gearDate.querySelector(".lcalendar_finish");r.addEventListener("touchstart",f);var i=A.gearDate.querySelector(".date_yy"),d=A.gearDate.querySelector(".date_mm"),n=A.gearDate.querySelector(".date_dd"),v=A.gearDate.querySelector(".time_hh"),l=A.gearDate.querySelector(".time_mm");i.addEventListener("touchstart",m),d.addEventListener("touchstart",m),n.addEventListener("touchstart",m),v.addEventListener("touchstart",m),l.addEventListener("touchstart",m),i.addEventListener("touchmove",g),d.addEventListener("touchmove",g),n.addEventListener("touchmove",g),v.addEventListener("touchmove",g),l.addEventListener("touchmove",g),i.addEventListener("touchend",h),d.addEventListener("touchend",h),n.addEventListener("touchend",h),v.addEventListener("touchend",h),l.addEventListener("touchend",h),t(e)}function s(){var e=new Date,t={yy:e.getFullYear(),mm:e.getMonth(),dd:e.getDate()-1,hh:e.getHours(),mi:e.getMinutes()};/^\d{4}-\d{1,2}-\d{1,2}\s\d{2}:\d{2}$/.test(A.trigger.value)?(rs=A.trigger.value.match(/(^|-|\s|:)\d{1,4}/g),t.yy=rs[0]-A.minY,t.mm=rs[1].replace(/-/g,"")-1,t.dd=rs[2].replace(/-/g,"")-1,t.hh=parseInt(rs[3].replace(/\s0?/g,"")),t.mi=parseInt(rs[4].replace(/:0?/g,""))):t.yy=t.yy-A.minY,A.gearDate.querySelector(".date_yy").setAttribute("val",t.yy),A.gearDate.querySelector(".date_mm").setAttribute("val",t.mm),A.gearDate.querySelector(".date_dd").setAttribute("val",t.dd),c(),A.gearDate.querySelector(".time_hh").setAttribute("val",t.hh),A.gearDate.querySelector(".time_mm").setAttribute("val",t.mi),o()}function v(e){A.gearDate=document.createElement("div"),A.gearDate.className="gearDate",A.gearDate.innerHTML='<div class="date_ctrl slideInUp"><div class="date_btn_box"><div class="date_btn lcalendar_cancel">取消</div><div class="date_btn lcalendar_finish">确定</div></div><div class="date_roll_mask"><div class="time_roll"><div><div class="gear time_hh" data-datetype="time_hh"></div><div class="date_grid"><div>时</div></div></div><div><div class="gear time_mm" data-datetype="time_mm"></div><div class="date_grid"><div>分</div></div></div></div></div></div>',document.body.appendChild(A.gearDate),l();var a=A.gearDate.querySelector(".lcalendar_cancel");a.addEventListener("touchstart",b);var r=A.gearDate.querySelector(".lcalendar_finish");r.addEventListener("touchstart",E);var i=A.gearDate.querySelector(".time_hh"),d=A.gearDate.querySelector(".time_mm");i.addEventListener("touchstart",m),d.addEventListener("touchstart",m),i.addEventListener("touchmove",g),d.addEventListener("touchmove",g),i.addEventListener("touchend",h),d.addEventListener("touchend",h),t(e)}function l(){var e=new Date,t={hh:e.getHours(),mm:e.getMinutes()};/^\d{2}:\d{2}$/.test(A.trigger.value)&&(rs=A.trigger.value.match(/(^|:)\d{2}/g),t.hh=parseInt(rs[0].replace(/^0?/g,"")),t.mm=parseInt(rs[1].replace(/:0?/g,""))),A.gearDate.querySelector(".time_hh").setAttribute("val",t.hh),A.gearDate.querySelector(".time_mm").setAttribute("val",t.mm),o()}function c(){var e=A.maxY-A.minY+1,t=A.gearDate.querySelector(".date_yy"),a="";if(t&&t.getAttribute("val")){for(var r=parseInt(t.getAttribute("val")),i=0;e-1>=i;i++)a+="<div class='tooth'>"+(A.minY+i)+"</div>";t.innerHTML=a;var d=Math.floor(parseFloat(t.getAttribute("top")));if(isNaN(d))t.style["-webkit-transform"]="translate3d(0,"+(8-2*r)+"em,0)",t.setAttribute("top",8-2*r+"em");else{d%2==0?d=d:d+=1,d>8&&(d=8);var n=8-2*(e-1);n>d&&(d=n),t.style["-webkit-transform"]="translate3d(0,"+d+"em,0)",t.setAttribute("top",d+"em"),r=Math.abs(d-8)/2,t.setAttribute("val",r)}var s=A.gearDate.querySelector(".date_mm");if(s&&s.getAttribute("val")){a="";var v=parseInt(s.getAttribute("val")),l=11,c=0;r==e-1&&(l=A.maxM-1),0==r&&(c=A.minM-1);for(var i=0;l-c+1>i;i++)a+="<div class='tooth'>"+(c+i+1)+"</div>";s.innerHTML=a,v>l?(v=l,s.setAttribute("val",v)):c>v&&(v=l,s.setAttribute("val",v)),s.style["-webkit-transform"]="translate3d(0,"+(8-2*(v-c))+"em,0)",s.setAttribute("top",8-2*(v-c)+"em");var o=A.gearDate.querySelector(".date_dd");if(o&&o.getAttribute("val")){a="";var m=parseInt(o.getAttribute("val")),g=u(r,v),h=g-1,_=0;r==e-1&&A.maxM==v+1&&(h=A.maxD-1),0==r&&A.minM==v+1&&(_=A.minD-1);for(var i=0;h-_+1>i;i++)a+="<div class='tooth'>"+(_+i+1)+"</div>";o.innerHTML=a,m>h?(m=h,o.setAttribute("val",m)):_>m&&(m=_,o.setAttribute("val",m)),o.style["-webkit-transform"]="translate3d(0,"+(8-2*(m-_))+"em,0)",o.setAttribute("top",8-2*(m-_)+"em")}}}}function o(){var e=A.gearDate.querySelector(".time_hh");if(e&&e.getAttribute("val")){for(var t="",a=parseInt(e.getAttribute("val")),r=0;23>=r;r++)t+="<div class='tooth'>"+r+"</div>";e.innerHTML=t,e.style["-webkit-transform"]="translate3d(0,"+(8-2*a)+"em,0)",e.setAttribute("top",8-2*a+"em");var i=A.gearDate.querySelector(".time_mm");if(i&&i.getAttribute("val")){for(var t="",d=parseInt(i.getAttribute("val")),r=0;59>=r;r++)t+="<div class='tooth'>"+r+"</div>";i.innerHTML=t,i.style["-webkit-transform"]="translate3d(0,"+(8-2*d)+"em,0)",i.setAttribute("top",8-2*d+"em")}}}function u(e,t){return 1==t?(e+=A.minY,e%4==0&&e%100!=0||e%400==0&&e%4e3!=0?29:28):3==t||5==t||8==t||10==t?30:31}function m(e){e.preventDefault();for(var t=e.target;;){if(t.classList.contains("gear"))break;t=t.parentElement}clearInterval(t["int_"+t.id]),t["old_"+t.id]=e.targetTouches[0].screenY,t["o_t_"+t.id]=(new Date).getTime();var a=t.getAttribute("top");t["o_d_"+t.id]=a?parseFloat(a.replace(/em/g,"")):0,t.style.webkitTransitionDuration=t.style.transitionDuration="0ms"}function g(e){e.preventDefault();for(var t=e.target;;){if(t.classList.contains("gear"))break;t=t.parentElement}t["new_"+t.id]=e.targetTouches[0].screenY,t["n_t_"+t.id]=(new Date).getTime();var a=30*(t["new_"+t.id]-t["old_"+t.id])/window.innerHeight;t["pos_"+t.id]=t["o_d_"+t.id]+a,t.style["-webkit-transform"]="translate3d(0,"+t["pos_"+t.id]+"em,0)",t.setAttribute("top",t["pos_"+t.id]+"em"),e.targetTouches[0].screenY<1&&h(e)}function h(e){e.preventDefault();for(var t=e.target;;){if(t.classList.contains("gear"))break;t=t.parentElement}var a=(t["new_"+t.id]-t["old_"+t.id])/(t["n_t_"+t.id]-t["o_t_"+t.id]);t["spd_"+t.id]=Math.abs(a)<=.2?0>a?-.08:.08:Math.abs(a)<=.5?0>a?-.16:.16:a/2,t["pos_"+t.id]||(t["pos_"+t.id]=0),_(t)}function _(e){function t(){e.style.webkitTransitionDuration=e.style.transitionDuration="200ms",r=!0}var a=0,r=!1,i=A.maxY-A.minY+1;clearInterval(e["int_"+e.id]),e["int_"+e.id]=setInterval(function(){var d=e["pos_"+e.id],n=e["spd_"+e.id]*Math.exp(-.03*a);if(d+=n,Math.abs(n)>.1);else{var s=2*Math.round(d/2);d=s,t()}switch(d>8&&(d=8,t()),e.dataset.datetype){case"date_yy":var v=8-2*(i-1);if(v>d&&(d=v,t()),r){var l=Math.abs(d-8)/2;y(e,l),clearInterval(e["int_"+e.id])}break;case"date_mm":var c=A.gearDate.querySelector(".date_yy"),o=parseInt(c.getAttribute("val")),m=11,g=0;o==i-1&&(m=A.maxM-1),0==o&&(g=A.minM-1);var v=8-2*(m-g);if(v>d&&(d=v,t()),r){var l=Math.abs(d-8)/2+g;y(e,l),clearInterval(e["int_"+e.id])}break;case"date_dd":var c=A.gearDate.querySelector(".date_yy"),h=A.gearDate.querySelector(".date_mm"),o=parseInt(c.getAttribute("val")),_=parseInt(h.getAttribute("val")),b=u(o,_),D=b-1,p=0;o==i-1&&A.maxM==_+1&&(D=A.maxD-1),0==o&&A.minM==_+1&&(p=A.minD-1);var v=8-2*(D-p);if(v>d&&(d=v,t()),r){var l=Math.abs(d-8)/2+p;y(e,l),clearInterval(e["int_"+e.id])}break;case"time_hh":if(-38>d&&(d=-38,t()),r){var l=Math.abs(d-8)/2;y(e,l),clearInterval(e["int_"+e.id])}break;case"time_mm":if(-110>d&&(d=-110,t()),r){var l=Math.abs(d-8)/2;y(e,l),clearInterval(e["int_"+e.id])}}e["pos_"+e.id]=d,e.style["-webkit-transform"]="translate3d(0,"+d+"em,0)",e.setAttribute("top",d+"em"),a++},30)}function y(e,t){t=Math.round(t),e.setAttribute("val",t),/date/.test(e.dataset.datetype)?c():o()}function b(e){e.preventDefault();var t;try{t=new CustomEvent("input")}catch(e){t=document.createEvent("Event"),t.initEvent("input",!0,!0)}A.trigger.dispatchEvent(t),document.body.removeChild(A.gearDate),A.gearDate=null}function D(e){var t=A.maxY-A.minY+1,a=parseInt(Math.round(A.gearDate.querySelector(".date_yy").getAttribute("val"))),r=parseInt(Math.round(A.gearDate.querySelector(".date_mm").getAttribute("val")))+1;r=r>9?r:"0"+r;var i=parseInt(Math.round(A.gearDate.querySelector(".date_dd").getAttribute("val")))+1;i=i>9?i:"0"+i,A.trigger.value=a%t+A.minY+"-"+r+"-"+i,A.successCallback(A.trigger.value),b(e)}function p(e){var t=A.maxY-A.minY+1,a=parseInt(Math.round(A.gearDate.querySelector(".date_yy").getAttribute("val"))),r=parseInt(Math.round(A.gearDate.querySelector(".date_mm").getAttribute("val")))+1;r=r>9?r:"0"+r,A.trigger.value=a%t+A.minY+"-"+r,A.successCallback(A.trigger.value),b(e)}function f(e){var t=A.maxY-A.minY+1,a=parseInt(Math.round(A.gearDate.querySelector(".date_yy").getAttribute("val"))),r=parseInt(Math.round(A.gearDate.querySelector(".date_mm").getAttribute("val")))+1;r=r>9?r:"0"+r;var i=parseInt(Math.round(A.gearDate.querySelector(".date_dd").getAttribute("val")))+1;i=i>9?i:"0"+i;var d=parseInt(Math.round(A.gearDate.querySelector(".time_hh").getAttribute("val")));d=d>9?d:"0"+d;var n=parseInt(Math.round(A.gearDate.querySelector(".time_mm").getAttribute("val")));n=n>9?n:"0"+n,A.trigger.value=a%t+A.minY+"-"+r+"-"+i+" "+(d.length<2?"0":"")+d+(n.length<2?":0":":")+n,A.successCallback(A.trigger.value),b(e)}function E(e){var t=parseInt(Math.round(A.gearDate.querySelector(".time_hh").getAttribute("val")));t=t>9?t:"0"+t;var a=parseInt(Math.round(A.gearDate.querySelector(".time_mm").getAttribute("val")));a=a>9?a:"0"+a,A.trigger.value=(t.length<2?"0":"")+t+(a.length<2?":0":":")+a,A.successCallback(A.trigger.value),b(e)}function L(e,t){function a(e,t){if(t===e)return!0;for(var a=t.getElementsByTagName("*"),r=0,i=a.length;i>r;r++)if(a[r]===e)return!0;return!1}var e=e?e:window.event;target=e.target||e.scrElement,a(target,t)||b(e)}var A=this;A.trigger.addEventListener("click",{ym:i,date:a,datetime:n,time:v}[e])}},e}();